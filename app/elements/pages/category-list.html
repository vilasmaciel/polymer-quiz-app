<dom-module id="category-list">
  <template>
    <style is="custom-style" include="app-themes"></style>

    <paper-scroll-header-panel id="scrollHeader" condenses keep-condensed-header mode="waterfall-tall" on-paper-header-transform="animateTitle">

      <!-- Main Toolbar -->
      <paper-toolbar id="mainToolbar" class="tall main">

        <div class="layout horizontal flex">
          <div class="flex"></div>
          <paper-menu-button id="mainMenu" horizontal-align="right" vertical-align="top">
            <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
            <paper-menu class="dropdown-content" style="width:150px">
              <paper-item>Profile</paper-item>
              <paper-item on-tap="_logout">Logout</paper-item>
            </paper-menu>
          </paper-menu-button>
        </div>


        <!-- Application name -->
        <div class="middle middle-container center horizontal layout">
          <user-avatar user="[[user]]"></user-avatar>
          <div class="app-name">Quiz App</div>
        </div>

        <!-- Application sub title -->
        <div class="bottom bottom-container center horizontal layout">
          <div class="bottom-title paper-font-subhead">Question/Answer Application built with Polymer!</div>
        </div>

      </paper-toolbar>

      <div class="layout horizontal wrap">

        <template id="content" is="dom-repeat" items="[[items]]">

          <paper-card elevation="1" on-tap="_categorySelected" class$="[[concatClass('tile flex layout vertical', item.theme)]]" activityId$="[[item.activityId]]">
            <div class="icon layout horizontal center-justified  center flex">
              <iron-icon icon="[[getCategoryIcon(item.icon)]]"></iron-icon>
            </div>
            <div class="tile-footer layout horizontal center">
              <div class="paper-font-body1 layout flex center center-justified">{{item.name}}</div>
              <iron-icon icon="av:play-arrow"></iron-icon>
            </div>
            <div class="tileContainer layout fit" id="[[item.activityId]]" </div>
          </paper-card>
        </template>

        </div>

    </paper-scroll-header-panel>
  </template>

  <script>
  (function() {
    Polymer({

      is: 'category-list',

      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior,
        Polymer.NeonAnimationRunnerBehavior,
        QuizApp.AppUtilsBehavior
      ],

      properties: {
        items: {
          type: Array,
          notify: true,
          observer: '_itemsChanged'
        },
        user: {
          type: Object
        },
        category: {
          type: String
        },

        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'cascaded-animation',
                animation: 'transform-animation',
                transformFrom: 'translateY(150%)',
                transformTo: 'none',
                nodes: []
              }, {
                name: 'slide-down-animation',
                node: this.$.mainToolbar,
              }],
              'exit': {
                name: 'fade-out-animation',
                node: this
              }
            };
          }
        },

        sharedElements: {
          value: function() {}
        }
      },

      show: function() {
        this.style.opacity = 1;
        this.playAnimation('entry');
      },

      _itemsChanged: function() {
        this.async(function() {
          var nodeList = Polymer.dom(this.root).querySelectorAll('.tile');
          if (nodeList) {
            this.animationConfig.entry[0].nodes = Array.prototype.slice.call(nodeList);
          }
        });
        this.$.scrollHeader.measureHeaderHeight();

        var _this = this;

        setTimeout(function() {
          _this.show();
        }, 100);
      },

      _categorySelected: function(event) {
        var target = event.target;
        this.sharedElements = {
          'hero': target.parentElement
        };

        this.animationConfig.exit = [{
          name: 'cascaded-animation',
          animation: 'scale-down-animation'
        }, {
          name: 'hero-animation',
          id: 'hero',
          fromPage: this
        }];

        var nodesToScale = [];
        var tiles = Polymer.dom(this.root).querySelectorAll('.tile');

        for (var i = 0; i < tiles.length; i++) {
          var node = tiles[i];
          if (node.getAttribute('activityId') !== target.getAttribute('activityId')) {
            nodesToScale.push(node);
          }
        }

        this.animationConfig.exit[0].nodes = nodesToScale;
        this.fire('category-selected', target.id);
      },

      _logout: function() {
        this.animationConfig.exit = {
          name: 'fade-out-animation',
          node: this
        };
        this.fire('logout');
      }

    });

  })();
  </script>

</dom-module>
