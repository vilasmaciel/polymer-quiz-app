<dom-module id="category-element">
  <style>

  .tile {
    min-width: 250px;
    max-width: 350px;
    height: 300px;
    margin: 15px;
    cursor: pointer;
    color: white;
    background-color: #F44336;
  }

  .tile .tile-footer {
    height: 30px;
    border-top: 1px solid #ccc;
    padding: 10px;
  }

  .tile .icon iron-icon {
    --iron-icon-height: 62px;
    --iron-icon-width: 62px;
  }

  paper-scroll-header-panel {
    height: 100%;
    background: white;
    --paper-scroll-header-panel-full-header: {
      background-color: #F44336;
    }
    ;
    --paper-scroll-header-panel-condensed-header: {
      background-color: #F44336;
    }
    ;
  }

  paper-toolbar.tall {
    background-color: transparent;
  }

  paper-toolbar.tall .app-name {
    font-size: 40px;
    font-weight: 300;
    /* Required for main area's paper-scroll-header-panel custom condensing transformation */
    -webkit-transform-origin: left center;
    transform-origin: left center;
  }

  #mainToolbar .middle-container {
    height: 100%;
    margin-left: 48px;
  }

  #mainToolbar:not(.tall) .middle {
    font-size: 18px;
    padding-bottom: 0;
  }

  #mainToolbar .bottom {
    margin-left: 48px;
    /* Required for main area's paper-scroll-header-panel custom condensing transformation */
    -webkit-transform-origin: left center;
    transform-origin: left center;
  }
  </style>

  <template>
    <paper-scroll-header-panel id="scrollHeader" condenses keep-condensed-header mode="waterfall-tall" on-paper-header-transform="animateTitle">

      <!-- Main Toolbar -->
      <paper-toolbar id="mainToolbar" class="tall">

        <paper-icon-button on-click="close" icon="arrow-back"></paper-icon-button>

        <span class="flex"></span>

        <!-- Application name -->
        <div class="middle middle-container center horizontal layout">
          <div class="app-name">[[category.name]]</div>
        </div>

        <!-- Application sub title -->
        <div class="bottom bottom-container center horizontal layout">
          <div class="bottom-title paper-font-subhead"></div>
        </div>

      </paper-toolbar>

      <div class="layout horizontal wrap">
        <template is="dom-repeat" items="[[category.tests]]">

          <paper-material elevation="1" class="tile flex layout vertical" id="[[item.activityId]]">

            <div class="icon layout horizontal center-justified  center flex">
              <iron-icon icon="home"></iron-icon>
            </div>

            <div class="tile-footer layout horizontal center">
              <div class="paper-font-body1 layout flex center center-justified">{{item.name}}</div>
              <iron-icon icon="av:play-arrow"></iron-icon>
            </div>

          </paper-material elevation>

        </template>
      </div>

    </paper-scroll-header-panel>
  </template>

  <script>
  (function() {
    Polymer({

      is: 'category-element',

      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior,
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        category: {
          type: Object,
          notify: true,
          observer: '_itemsChanged'
        },

        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'hero-animation',
                id: 'hero',
                toPage: this
              }, {
                name: 'fade-in-animation'
              }],
              'exit': {
                name: 'scale-down-animation',
                node: this
              }
            }
          }
        },

        sharedElements: {
          value: function() {
            return {
              'hero': this.$.mainToolbar
            }
          }
        }

      },

      animateTitle: function(e) {
        var appName = this.querySelector('.app-name');
        var middleContainer = this.querySelector('.middle-container');
        var bottomContainer = this.querySelector('.bottom-container');
        var detail = e.detail;
        var heightDiff = detail.height - detail.condensedHeight;
        console.log(detail.height);
        var yRatio = Math.min(1, detail.y / heightDiff);
        var maxMiddleScale = 0.50; // appName max size when condensed. The smaller the number the smaller the condensed size.
        var scaleMiddle = Math.max(maxMiddleScale, (heightDiff - detail.y) / (heightDiff / (1 - maxMiddleScale)) + maxMiddleScale);
        var scaleBottom = 1 - yRatio;

        // Move/translate middleContainer
        Polymer.Base.transform('translate3d(0,' + yRatio * 100 + '%,0)', middleContainer);

        // Scale bottomContainer and bottom sub title to nothing and back
        Polymer.Base.transform('scale(' + scaleBottom + ') translateZ(0)', bottomContainer);

        // Scale middleContainer appName
        Polymer.Base.transform('scale(' + scaleMiddle + ') translateZ(0)', appName);
      },

      _itemsChanged: function() {
        this.async(function() {
          var nodeList = Polymer.dom(this.root).querySelectorAll('.tile');
          this.animationConfig['entry'][1].nodes = Array.prototype.slice.call(nodeList);
        });
        this.$.scrollHeader.measureHeaderHeight();
      },

      close: function() {
        this.fire('close');
      }

    });

  })();
  </script>

</dom-module>
